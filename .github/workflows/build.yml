      - name: Build universal binary
        shell: bash
        run: |
          set -euo pipefail

          cd SpaceInvadersScreensaver_Packagename: Build macOS Screensaver

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Show repo structure (debug)
        shell: bash
        run: |
          set -euo pipefail
          echo "== root =="
          ls -la
          echo "== SpaceInvadersScreensaver_Package =="
          ls -la SpaceInvadersScreensaver_Package || true
          echo "== saver bundle =="
          ls -la SpaceInvadersScreensaver_Package/SpaceInvadersScreensaver.saver || true

      - name: Build universal binary into .saver bundle
        shell: bash
        run: |
          set -euo pipefail

          cd SpaceInvadersScreensaver_Package

          # Validaciones rápidas
          test -f SpaceInvadersScreensaver.swift
          test -d SpaceInvadersScreensaver.saver

          # Asegurar carpeta del binario dentro del bundle
          mkdir -p SpaceInvadersScreensaver.saver/Contents/MacOS

          # Compilar universal (Intel + Apple Silicon)
          swiftc \
            -target x86_64-apple-macosx13.0 \
            -target arm64-apple-macosx13.0 \
            -framework Cocoa \
            -framework ScreenSaver \
            -framework WebKit \
            -emit-library \
            -o SpaceInvadersScreensaver.saver/Contents/MacOS/SpaceInvadersScreensaver \
            SpaceInvadersScreensaver.swift

          echo "✅ Built binary:"
          file SpaceInvadersScreensaver.saver/Contents/MacOS/SpaceInvadersScreensaver

          echo "✅ Bundle contents:"
          ls -la SpaceInvadersScreensaver.saver/Contents
          ls -la SpaceInvadersScreensaver.saver/Contents/MacOS

      - name: Upload artifact (.saver)
        uses: actions/upload-artifact@v4
        with:
          name: SpaceInvadersScreensaver
          path: SpaceInvadersScreensaver_Package/SpaceInvadersScreensaver.saver
